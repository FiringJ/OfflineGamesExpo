# 关键业务流程

本文档描述了离线游戏应用的核心业务流程和游戏机制实现。

## 通用游戏流程

所有游戏共享以下通用流程：

1. **游戏初始化**
   - 加载游戏资源
   - 初始化游戏状态
   - 加载保存的最高分
   - 初始化音频系统

2. **游戏循环**
   - 处理用户输入
   - 更新游戏状态
   - 渲染游戏画面
   - 检查游戏条件（胜利/失败）

3. **游戏数据存储**
   - 记录游戏分数
   - 保存游戏统计数据
   - 更新游戏记录

4. **音频控制**
   - 加载背景音乐和音效
   - 根据游戏事件播放音效
   - 管理音频状态（静音/播放）

## 2048游戏流程

### 核心机制
1. **初始化棋盘**
   - 创建4x4网格
   - 随机生成2个初始方块（90%概率为2，10%概率为4）

2. **方块移动逻辑**
   - 检测滑动方向（上/下/左/右）
   - 按方向移动所有方块
   - 合并相同数值的相邻方块
   - 计算得分（合并方块值之和）
   - 生成新的随机方块

3. **胜利/失败条件**
   - 胜利：达成2048方块
   - 失败：棋盘填满且无法合并

4. **手势处理**
   - 使用PanResponder捕获滑动手势
   - 根据滑动方向和距离触发移动

### 关键算法
- **方向数组映射**：将用户滑动转换为方向枚举
- **合并算法**：相同数值方块合并并翻倍
- **游戏状态评估**：检查是否还有可能的移动

## 俄罗斯方块流程

### 核心机制
1. **初始化游戏**
   - 创建游戏面板（通常10x20网格）
   - 定义七种基本方块形状及颜色

2. **方块生成与控制**
   - 随机生成方块形状
   - 方块下落逻辑（定时器控制）
   - 旋转方块（90度旋转矩阵）
   - 左右移动方块
   - 快速下落（硬降）

3. **碰撞检测**
   - 边界检测
   - 方块间碰撞检测
   - 方块锁定

4. **消行与得分**
   - 检测并消除完整行
   - 计算得分（基于消除行数和等级）
   - 增加游戏难度（加快下落速度）

### 关键算法
- **旋转矩阵算法**：处理方块旋转
- **墙踢算法**：旋转时防止与墙壁碰撞
- **消行算法**：检查并删除已满行

## 贪吃蛇流程

### 核心机制
1. **初始化游戏**
   - 创建游戏网格
   - 初始化蛇的起始位置
   - 生成第一个食物

2. **蛇的移动控制**
   - 维护蛇身体节点数组
   - 根据方向更新蛇头位置
   - 根据是否吃到食物决定是否增长
   - 防止180度转向

3. **碰撞检测**
   - 检测蛇头是否碰到边界（循环模式）
   - 检测蛇头是否碰到自身
   - 检测蛇头是否吃到食物

4. **食物生成**
   - 随机位置生成
   - 确保不与蛇身重叠

### 关键算法
- **蛇移动算法**：维护蛇身体节点队列
- **食物随机生成算法**：确保位置有效
- **碰撞检测算法**：检查各种碰撞情况

## 扫雷流程

### 核心机制
1. **初始化游戏**
   - 创建游戏网格（不同难度有不同尺寸）
   - 设置地雷数量
   - 首次点击后随机放置地雷（确保首次安全）

2. **单元格处理**
   - 计算每个单元格周围的地雷数
   - 处理单元格点击事件
   - 处理单元格标记（右键/长按）

3. **揭示逻辑**
   - 点击空白单元格时递归揭示周围区域
   - 标记可疑地雷位置

4. **胜利/失败条件**
   - 胜利：所有非地雷单元格被揭示
   - 失败：点击到地雷

### 关键算法
- **邻居计数算法**：计算周围八个方向的地雷数量
- **递归揭示算法**：揭示空白区域
- **地雷放置算法**：确保首次点击安全

## 音频系统流程

1. **音频资源管理**
   - 预加载游戏音频资源
   - 管理音频实例

2. **音效触发逻辑**
   - 根据游戏事件触发对应音效
   - 背景音乐循环播放

3. **音量控制**
   - 静音/取消静音功能
   - 音量调节（可扩展）

4. **音频状态管理**
   - 游戏暂停时暂停音频
   - 应用切换到后台时处理音频

## 数据存储流程

1. **分数记录**
   - 实时更新游戏分数
   - 比较并更新最高分
   - 存储最高分记录

2. **游戏统计**
   - 记录游戏次数
   - 记录游戏时长
   - 记录特殊成就

3. **数据持久化**
   - 使用AsyncStorage存储数据
   - 应用启动时加载数据
   - 数据结构化存储 